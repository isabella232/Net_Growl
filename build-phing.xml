<?xml version="1.0" encoding="UTF-8"?>
<project name="netgrowl" default="help" basedir=".">

    <!-- TIP found in ticket#62 (http://www.phing.info/trac/ticket/62) -->
    <php function="dirname" returnProperty="phing.buildfile.dirname">
        <param value="${phing.file}"/>
    </php>

    <property name="default.properties" value="${phing.buildfile.dirname}/local.win.properties"/>
    <property file="${default.properties}"/>

    <target name="help">
        <echo>Target                   Description</echo>
        <echo>------------------------------------------------------------------</echo>
        <echo>clean-docs               Remove old html generated files</echo>
        <echo>clean-docs-sources       Remove old sources html generated files</echo>
        <echo>make-docs                Build the documentation of Net_Growl</echo>
        <echo>make-docs-sources        Build the highlighted source code of Net_Growl</echo>
        <echo>make-full-docs           Build the full documentation of Net_Growl</echo>
        <echo>make-userguide           Build the user guide of Net_Growl</echo>
        <echo>make-userguide-all       Build the user guide of Net_Growl in all formats</echo>
        <echo>make-userguide-chunked   Build the user guide of Net_Growl in many HTML files</echo>
        <echo>make-userguide-htmlhelp  Build the user guide of Net_Growl in CHM format</echo>
        <echo>make-userguide-pdf       Build the user guide of Net_Growl in PDF format</echo>
    </target>

    <target name="make-userguide-all"
            depends="make-userguide, make-userguide-chunked, make-userguide-htmlhelp, make-userguide-pdf"
            description="Build the user guide of Net_Growl in all formats">

    </target>

    <target name="make-userguide"
            description="Build the user guide of Net_Growl">

        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -a toc2 -n -o ${output.dir}/userguide.html ${homedir}/docs/userguide.txt"
        />
        <zip destfile="${output.dir}/bin/userguide.zip">
            <fileset dir="${output.dir}">
                <include name="images/**" />
                <include name="js/asciidoc.js" />
                <include name="styles/pygments.css" />
                <include name="styles/toc2.css" />
                <include name="styles/${theme}.css" />
                <include name="userguide.html" />
                <exclude name="**/callouts/**" />
                <exclude name="styles.css" />
                <exclude name="**/Thumbs.db" />
            </fileset>
        </zip>

    </target>

    <target name="make-userguide-chunked"
            description="Build the user guide of Net_Growl in many HTML files">

        <exec dir="${asciidoc.home}"
            command="a2x.py -L --icons --stylesheet=./stylesheets/docbook-xsl.css -d book -f chunked -D ${output.dir}/bin ${homedir}/docs/userguide.txt"
        />
        <zip destfile="${output.dir}/bin/userguide.chunked.zip">
            <fileset dir="${output.dir}/bin">
                <include name="userguide.chunked/**" />
                <exclude name="userguide.chunked/**/Thumbs.db" />
            </fileset>
        </zip>
        <delete dir="${output.dir}/bin/userguide.chunked" />

    </target>

    <target name="make-userguide-htmlhelp"
            description="Build the user guide of Net_Growl in CHM format">

        <exec dir="${asciidoc.home}"
            command="a2x.py -L --icons --stylesheet=./stylesheets/docbook-xsl.css -d book -f htmlhelp -D ${output.dir}/bin ${homedir}/docs/userguide.txt"
        />

        <exec dir="${htmlhelpworkshop}"
            command="hhc.exe ${output.dir}/bin/userguide.hhp"
        />
        <zip destfile="${output.dir}/bin/userguide.chm.zip">
            <fileset dir="${output.dir}/bin">
                <include name="userguide.chm" />
            </fileset>
        </zip>
        <delete>
            <fileset dir="${output.dir}/bin">
                <include name="userguide.chm" />
                <include name="userguide.hhc" />
                <include name="userguide.hhk" />
                <include name="userguide.hhp" />
            </fileset>
        </delete>
        <delete dir="${output.dir}/bin/userguide.htmlhelp" />

    </target>

    <target name="make-userguide-pdf"
            description="Build the user guide of Net_Growl in PDF format">

        <exec dir="${asciidoc.home}"
            command="a2x.py -L --icons --stylesheet=./stylesheets/docbook-xsl.css -d book -f pdf --fop -D ${output.dir}/bin ${homedir}/docs/userguide.txt"
        />

    </target>

    <target name="make-docs"
            description="Build the documentation of Net_Growl">

        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/CHANGELOG.html ${homedir}/docs/CHANGELOG.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/INSTALL.html ${homedir}/docs/INSTALL.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/LICENSE.html ${homedir}/docs/LICENSE.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/bin/index.html ${homedir}/docs/bin/index.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -a toc2 -n -o ${output.dir}/index.html ${homedir}/docs/index.txt"
        />

    </target>

    <target name="make-full-docs"
            depends="make-docs-sources, make-docs, make-userguide-all"
            description="Build the full documentation of Net_Growl">

    </target>

    <target name="clean-docs"
            description="Remove old html generated files">

        <delete>
            <fileset dir="${homedir}/docs">
                <include name="*.html" />
            </fileset>
        </delete>

    </target>

    <target name="clean-docs-sources"
            description="Remove old sources html generated files">

        <delete>
            <fileset dir="${homedir}/docs/sources">
                <include name="*.html" />
            </fileset>
        </delete>

    </target>

    <target name="make-docs-sources"
            description="Build the highlighted source code of Net_Growl">

        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Application.html ${homedir}/docs/sources/Application.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Exception.html ${homedir}/docs/sources/Exception.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Gntp.html ${homedir}/docs/sources/Gntp.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/gntpAdapter.html ${homedir}/docs/sources/gntpAdapter.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/gntpAdapterSecurity.html ${homedir}/docs/sources/gntpAdapterSecurity.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/gntpAdapterSocketCallbacks.html ${homedir}/docs/sources/gntpAdapterSocketCallbacks.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/gntpAdapterUrlCallbacks.html ${homedir}/docs/sources/gntpAdapterUrlCallbacks.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/GntpMock.html ${homedir}/docs/sources/GntpMock.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Growl.html ${homedir}/docs/sources/Growl.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Response.html ${homedir}/docs/sources/Response.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/Udp.html ${homedir}/docs/sources/Udp.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/udpAdapter.html ${homedir}/docs/sources/udpAdapter.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -a linkcss -a icons -a theme=${theme} -o ${output.dir}/sources/udpAdapterNotifyPEARerrors.html ${homedir}/docs/sources/udpAdapterNotifyPEARerrors.txt"
        />

    </target>

</project>